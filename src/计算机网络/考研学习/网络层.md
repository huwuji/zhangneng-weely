#### 网络层
### 个人总结：
1. 网络层的功能：
    1）主要功能是定位网络中的主机功能。围绕查询对应主机，我们需要知道：   

    a.主机地址？---也就是ip地址。那就需要了解ip地址的组成，分类。   
    b.那问题来了，我们怎么去获取ip地址？   
        ？？ ip地址的分发：DHCP协议，。   

    > DHCP协议  

    c.主机或者路由器的ip地址分发了。那下一个问题来了，源主机知道了目标主机的ip地址，那怎么去查找呢？   
        ？？ARP协议：广播寻址，寻找ip对应的mac地址。然后把对应关系记录在高速缓存中。  
    > ARP协议：
    广播方式；有高速缓存。简单说是主机先查询ARP协议的高速缓存，没有再通过广播形式查询，当同一网段内都没有时，就把目标地址的mac地址补充为当前网关（路由）的接口的mac地址。然后路由器也通过ARP去查询，一层一层往外找（这里需要知道路由协议也是分层的），知道找到目的地址的mac地址。

    d.找到了目的主机后。我们需要与目的主机进行数据交换。那在网络层的数据交换需要做什么呢？   
    > 网络层的数据传输基本单位---数据报。所以需要组装传输层的报文段形成数据报（或者对数据报进行分片），基本点是在报文段头部加上源主机ip和目的ip及其他信息。或者拆分数据链路层的帧（去除帧的头部标示和尾部标示一起其他帧校验和纠正的标示）得到数据报。

    e.传输的数据格式有了，那传输的方式和协议呢？  
        在网络层上建立逻辑电路的种类有多种，可以建立一条专线通道，也可以与其他设备公用网络层通道。
        建立专线通道，如电话线，使用的是电路转换。成本高，利用率低，浪费。需要先连接，再确定连接，最后断开连接。优点：安全，建立连接后的信息传输快（不是指物理传输）。
        那怎么在很多节点的公共网络通道也能快速传递数据呢？找到最短的路径，建立一个虚电路（也就是有明确路标的线路）。这里涉及的就是路由寻址协议。也都是建立在路由层的协议。
        那下一个问题来来？公共的路径上也是有很多不同的数据，怎么确定不同的数据？
          也是问题的解决是在数据链路层，网络成要做的是，当把数据报分片时，要记录分片间的关系。
        那在网络层在这个方法没有办法做码？那不是，当然可以。网络层也可以校验数据报的准确性，只是每层有每层的功能。网络层在收到数据后，如果有应用的话，会继续网上层传递，网络层数据报在到达应用层前，还分出来了传输层，传输层会做端对端间的信息安全加密等。   
        那网络层在这里一般还做什么呢？控制流量。之前说了数据链路层会对物理层的数据传递做逻辑控制。数据链路层的控制可以理解是硬件的控制，当数据链路层的流量控制反馈到了网络层，网络层的用户‘也就是点对点通信中的点’是不是也可以主动来控制数据传输。这也就涉及到了ICMP协议。
    > ICMP协议（网络控制报文协议）:存在于网络层，是网络层和传输层连接的桥梁，支持主机或路由器。  
    作用：差错/异常报告。   
    网络探询。
    作用方式：通过发送特定ICMP报文。该报文会插入数据报的数据中。  
    以发送的ICMP报文信息分为：回送请求和回答报文，&& 时间超过差错报告报文。
    应用：包括ping，tracerroute.
    
    所以最后再反思网络层功能：也就是连接各个网络，然后在巨形网络或小型网络（而不是网段中）中建立点对点的连接。

    >拓展：
    数据链路层我们讲到了流量控制，流量控制是作用于接收端的，它是控制发送者的发送速度从而使接收者来得及接收，防止帧（分组）丢失。使用的方式是滑动窗口协议。
    拥塞控制：是作用于网络层的，它是防止过多数据注入到网络中，避免网络负载大的情况。控制方式和流量控制类似，使用拥塞窗口控制，方法和滚动窗口协议类似。




### 零零散散
1. 主要任务和功能：
    为互联网上点对点通信提供服务；  
    
    网络层的传输单位是ip数据报(datagram)；  
    分组（包）： 数据报(datagram)拆分而来；  
    基本物理层硬件：路由器；
    1）路由选择和分组转发 ；  
    2）异构网络互联；   
    !!!3）拥塞控制；   

2. 数据交换方式  
    1）电路交换：资源独占；步骤：a.建立连接--->b.通信--->c.释放连接；  
        优化：通信时延小。有序传输，没有冲突，实时性强；  
        缺点：建立连接时间长，链路使用效率低； 
    2）数据报/分组交换：
        思想：存储转发思想；   
        优点：a.灵活，无需建立连接，可根据网络情况随时发送。
            b. 链路利用率高；
            c. 可动态分配路径（根据路由器的寻址能力），提高可靠性,利用率和传输速率。
            d.可存储转发，可校验，提高可靠性；
        缺点：需要额外的存储转发时间和空间；需要校验和重组。

    > !!!分组交换可以为数据报方式和虚电路方式；   
        数据报方式是无连接服务；   
        虚电路方式是连接服务；   

    > 无连接：无连接服务：不事先为分组的传输确定传输路径；每个分组独立确定传输路径，不同的分组传输路径可能不同。  
    连接：连接服务：事先建立一条逻辑的传输路径；每个分组都按一条确定的路径传输；  

    > 拓展：网络层，传输层都提供了面向连接和无连接的服务方式？为何？  
    传输层的代码完全运行在用户的机器上，而网络层主要运行在承运商控制的路由器上，这也就是网络层应该在的地方，网络层的作用就是为数据包提供路由。这样就照成了用户对于网络层的控制几乎是没有的，用户只能控制自己机器上的程序。那么如果网络层提供的将服务不够用怎么办？ 如果他频繁的丢失分组怎么办？用户在网络层上并没有真正的控制权，所以他们不可能用最好的路由器或者在数据层上用更好的错误处理机制来解决服务太差的问题，唯一的可能是在网络层之上的另一层中提高服务质量。这样就是为什么会出现传输层的原因。  
    简单来说是增强主机（点）对数据的控制，提高数据交互的安全性，完整性（差错控制）；  

3. 路由器
    1）路由表   
    包括：目的网络IP地址，子网掩码，下一跳IP地址，接口   
    > 子网掩码(subnet mask)又叫网络掩码、地址掩码、子网络遮罩，它是一种用来指明一个IP地址的哪些位标识的是主机所在的子网，以及哪些位标识的是主机的位掩码。子网掩码不能单独存在，它必须结合IP地址一起使用。子网掩码只有一个作用，就是将某个IP地址划分成网络地址和主机地址两部分

    2）路由算法   
        a.静态路由算法     
        b.动态路由算法    
    3）分层次的路由选择协议

    4）网络地址转换NAT

    5) ARP协议:

    6）路由选择协议：   
    a.分为内部网关协议IGP（Interior Gateway Protocol）：RIP（Routing Information Protocol）协议（涉及距离向量算法--记录到能到达节点及其距离），&& OSPF(Open Shortest Path First)协议（记录全网链路的拓扑图,利用）   

    b.外部网关协议EGP（External Gateway Protocol）：  BGP协议（边界网关协议，Border Gateway Protocol） 是不同自治系统的路由器之间交换路由信息的协议。

 > 自治系统 AS (Autonomous System

4. ip
    1）ip的功能：定位
    2）ip的划分：网络位和主机位。
    > 延伸：ip地址的计算，A,B,C类通过子网掩码一起计算。无分类编址通过/n的标示。



